# Kết nối cơ sở dữ liệu MySQL

## Kết nối database

Cú pháp: 

`mysqli_connect($host,$user,$password,$database,$port,$socket)`

Ví dụ: ` mysqli_connect('localhost','root','','data')  or die("Không thể kết nối database")`

## Truy vấn lấy danh sách record

```
Kết nối database
$conn = mysqli_connect('localhost','root','','data') or die("Không thể kết nối database");

Câu truy vấn vào bảng trong database
$sql = "SELECT * FROM users";

Thực hiện truy vấn, hàm này truyền hai tham số vào là biến kết nối và câu truy  vấn.
$result = mysqli_query($conn,$sql);

Kiểm tra xem câu truy vấn có thực thi không.
if(!$result){
	die("Câu truy vấn bị sai.");
}

Lấy ra số hàng trong databasse
$num = mysqli_num_rows($sql);

Ngắt kết nối với database.
mysqli_close($conn);
```

## Câu truy vấn.

`$sql = "DELETE FROM users WHERE id = 1";`

Ý nghĩa câu truy vấn: Xoá tù bảng users có cột id = 1.

## Câu truy vấn update.

`$sql = "UPDATE users SET name = 'hungle' WHERE ID = 2"`

Ý nghĩa câu truy vấn: Cập nhập vào bảng users lưu với tên hungle với id = 2.


# Chức năng đăng ký thành viên.

## Tạo form đăng ký.

```
<div id="dangki" style="text-align: left;">
  <form method="POST" action="">
    <input type="text" name="ho" placeholder="Họ" style="width: 100px">  <input type="text" name="ten" placeholder="Tên" style="width: 100px"><br>
    <input type="email" name="email" placeholder="Địa chỉ email." style="width: 100px">  <input type="number" name="sdt" maxlength="11" placeholder="Phone number" style="width: 100px"><br>
    <input type="text" name="username" placeholder="Username" style="width: 100px"> <input type="password" name="password" maxlength="20" placeholder="Password" style="width: 100px">
    <br>
    Gender:
    <br>
    <input name="Gender" list="html" />
    <datalist id="html">
      <option value="Nam"></option>
      <option value="Nữ"></option>
    </datalist>
    <br> 
    Ngày sinh:
    <br>
    <input type="number" name="date" placeholder="Ngày" style="width: 60px" min="1" max="31">  <input type="number" min="1" max="12" name="mounth" placeholder="Tháng" style="width: 70px"> <input type="number" name="year" placeholder="Năm" style="width: 70px" min="1900" max="1999">
<br>
    <input type="submit" name="submit" value="Đăng ký">  <input type="reset" value="Đặt lại">
  </form>
</div>
```

Kết quả ta được form đăng ký như sau:

<img src="http://sv1.upsieutoc.com/2017/05/08/dangky.png">

## Thực hiện chữ năng đăng ký.

```
<?php
    require_once("lib/connection.php");// Lấy các kết nối CSDL từ file connection.php
    if (isset($_POST["submit"])) // Nếu người dùng nhấn nút submit thì thực hiện các câu lệnh bên dưới
{
        //lấy thông tin từ các form bằng phương thức POST
        //Gán các biến bằng các giá trị lấy từ các field đăng ký để xử lý thông tin.
      $ho = $_POST['ho'];
    $ten = $_POST['ten'];
    $email = $_POST['email'];
    $sdt = $_POST['sdt'];
    $username = $_POST['username'];
    $password = $_POST['password'];
    $Gender = $_POST['Gender'];
    $ngay = $_POST['date'];
    $thang = $_POST['mounth'];
    $nam = $_POST['year'];
        //Kiểm tra điều kiện bắt buộc đối với các field không được bỏ trống
        
    if($username=="" || $password=="" || $ho =="" || $ten=="" || $email == "" || $sdt == "" || $Gender == "" || $ngay == "" || $thang == "" || $nam =="")

     {
           echo "bạn vui lòng nhập đầy đủ thông tin";
        }else{
            // Kiểm tra tài khoản đã tồn tại chưa
            $sql="select * from users where username='$username'";// Câu lệnh truy vấn vào bảng users với cột username.
          $kt=mysqli_query($conn, $sql);// Câu lệnh truy vấn
 
          if(mysqli_num_rows($kt)  > 0)//Kiểm tra xem username đã tồn tại chưa.
          {
            echo "Tài khoản đã tồn tại";
          }
          else{
            //thực hiện việc lưu trữ dữ liệu vào db
              $sql = "INSERT INTO users (ho,ten,email,sdt,username,password,gender,ngaysinh,thangsinh,namsinh) VALUE('$ho','$ten','$email','$sdt','$username','$password','$Gender','$ngay','$thang','$nam')";// Lưu thông tin vào bảng users với các giá trị trong bảng từ các biến gán ban đầu.
              
              mysqli_query($conn,$sql);// Thực thi câu lệnh truy vấn để lưu thông tin.
              echo 'Chúc mừng bạn đã đăng kí thành công.'.''.'<a href="website.php">Trang Chủ</a>';// Xuất ra màn hình đã đăng ký thành công. Quay về trang chủ để đăng nhập.
          }
                      
          
        }
  }
  ?>
```

# Chức năng đăng nhập.

## Tạo form đăng nhập.

```
 <div id="sign">

  <form action="website.php" method="POST" name="dangnhap">
      Username :<input type="text" name="Username" placeholder="Username" /><br/>
      Password :<input type="Password" name="Password" placeholder="Password" /><br/>
       <input type="checkbox" name="vehicle1" value="Ghi nhớ đăng nhập">Ghi nhớ đăng nhập<br>
      <input type="submit" name="submit" value="Đăng nhập">
  </form>

  <form method="POST" action="dangky.php">
    <input type="submit" name="dangki" value="Đăng ký">
  </form>

</div>
```

Kết quả:

<img src="http://sv1.upsieutoc.com/2017/05/08/dangnhapcde69.png">

## Thực hiện chức năng đăng nhập.

```
//gọi file connection.
require_once("lib/connection.php");
if(isset($_POST["submit"]))
{
  // lấy thông tin người dùng.
  $Username = $_POST["Username"];
  $Password = $_POST["Password"];
  //làm sạch có thẻ html, ký tự đặc biệt.
  //mà người dùng cố tình thêm vào để tấn công theo phương thức sql injection.
  $Username = strip_tags($Username);
  $Username = addslashes($Username);
  $Password = strip_tags($Password);
  $Password = addslashes($Password);

  if ($Username == "" || $Password == "") // Kiểm tra xem username và password có trống không.
  {
    echo "Tên đăng nhập hoặc mật khẩu không được để trống";
  }
  else
  {
    $sql = "select * from users where username = '$Username' and Password = '$Password' ";
    $query = mysqli_query($conn,$sql); // câu lệnh truy vấn.
    $num_rows = mysqli_num_rows($query);//lấy ra số hàng trong databasse.
    if($num_rows==0)
    {
      echo "Tên đăng nhập hoặc mật khẩu không đúng.";
    }
    else
    {
      //tiến hành lưu tiên đăng nhập vào session để tiện xử lý sau này.
      $_SESSION['username']=$Username;

      header('website.php');
    }
  }
}
?>
```

# Chức năng tìm kiếm trong PHP.

## Tạo form tìm kiếm.

```
<div id="search">
  <div>
  <form action="ketqua.php" method="POST">
    <input type="text" name="search" placeholder="Enter your keyword...">
    <input type="submit" name="ok" value="Search">
  </form>
</div>
```

Kết quả như sau: 

<img src="http://sv1.upsieutoc.com/2017/05/08/search.png">

## Thực hiện chức năng tìm kiếm.

```
<?php 
  $conn = mysqli_connect("localhost","root","",'data') or die("Không thể kết nối.");//kết nối


  //$output = "";
  if(isset($_POST['ok']))
  {
    $search = addslashes($_POST['search']);// chống sql injection

    if($search == "")
    {
      echo "Nhập từ khoá";
      //$output = "Nhập từ khoá";
    }
    else
    {
      $query = "select * from users where username like '%$search%' ";//tim kiếm dữ liệu
      $sql = mysqli_query($conn,$query);//thực hiện câu lệnh truy vấn.
      $num = mysqli_num_rows($sql);//đếm ra số đong trong mảng.

      if($num == 0)
      {
        echo "Không có kết quả";
        //$output = "Không có kết quả.";
      }
      else
      {
        echo ("Có $num kết quả tìm thấy.<br>");
        while ($row = mysqli_fetch_assoc($sql)) {
          echo 'Tên: '.$row['username'];
          echo '<br>';
          echo 'Địa chỉ email: '.$row['email'];
        }
      }


    }
  }
?>
```

Kết quả:

<img src="http://sv1.upsieutoc.com/2017/05/08/oksearch.png">
